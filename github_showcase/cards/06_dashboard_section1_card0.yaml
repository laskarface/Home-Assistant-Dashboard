type: entities
card_mod:
  style: "ha-card {\n  background: none !important;\n  border: none !important;\n\
    \  box-shadow: none !important;\n  padding: 0 !important;\n  margin: 0 !important;\n\
    }\n#states {\n  padding: 0 !important;\n  margin: 0 !important;\n}\n.card-content\
    \ {\n  padding: 0 !important;\n  margin: 0 !important;\n}\n"
entities:
- type: custom:fold-entity-row
  padding: 0
  clickable: true
  card_mod:
    style: "div#head {\n  display: block !important;\n  width: 100% !important;\n\
      \  padding: 0 !important;\n  margin: 0 !important;\n  --toggle-icon-width: 0px\
      \ !important;\n}\n#head {\n  padding: 0 !important;\n  margin: 0 !important;\n\
      \  width: 100% !important;\n  cursor: pointer !important;\n  pointer-events:\
      \ auto !important;\n}\n#head ha-icon {\n  display: none !important;\n  width:\
      \ 0px !important;\n}\ndiv#items {\n  padding: 0 !important;\n  margin: 0 !important;\n\
      }\n"
  head:
    type: custom:button-card
    entity: sensor.suivi_greffe_jour
    show_name: false
    show_icon: false
    tap_action:
      action: none
    styles:
      card:
      - padding: 0
      - background: rgba(20, 27, 38, 0.6)
      - backdrop-filter: blur(10px)
      - -webkit-backdrop-filter: blur(10px)
      - border-radius: 20px
      - border: 1px solid rgba(79, 195, 247, 0.4)
      - box-shadow: 0 4px 15px rgba(0,0,0,0.2)
      - overflow: hidden
      - margin: 0px
      - box-sizing: border-box
      - cursor: pointer
      - pointer-events: none
      grid:
      - grid-template-areas: '"icon details" "footer footer"'
      - grid-template-columns: 130px minmax(0, 1fr)
      - grid-template-rows: 95px 30px
      - gap: 0px
      - width: 100%
      - margin: 0
      custom_fields:
        icon:
        - justify-self: stretch
        - align-self: stretch
        - border-right: 2px solid rgba(255,255,255,0.6)
        - border-top-left-radius: 20px
        - display: flex
        - align-items: center
        - justify-content: center
        - padding: 0
        details:
        - justify-self: stretch
        - align-self: stretch
        - display: flex
        - flex-direction: column
        - justify-content: center
        - align-items: center
        - padding: 0
        - overflow: hidden
        - position: relative
        footer:
        - justify-self: stretch
        - align-self: stretch
        - background: rgba(0,0,0,0.2)
        - border-top: 1px solid rgba(255,255,255,0.05)
        - display: flex
        - align-items: center
        - justify-content: center
        - border-radius: 0 0 20px 20px
    custom_fields:
      icon: "[[[\n  const svg = `\n    <svg viewBox=\"0 0 100 100\" width=\"65\" height=\"\
        65\" style=\"filter: drop-shadow(0 6px 12px rgba(0,0,0,0.5));\">\n      <defs>\n\
        \        <linearGradient id=\"kitBody\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"\
        100%\">\n          <stop offset=\"0%\" style=\"stop-color:#ffffff;stop-opacity:1\"\
        \ />\n          <stop offset=\"100%\" style=\"stop-color:#f0f0f0;stop-opacity:1\"\
        \ />\n        </linearGradient>\n        <linearGradient id=\"handleGrad\"\
        \ x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n          <stop offset=\"0%\"\
        \ style=\"stop-color:#d0d0d0;stop-opacity:1\" />\n          <stop offset=\"\
        100%\" style=\"stop-color:#a0a0a0;stop-opacity:1\" />\n        </linearGradient>\n\
        \        <radialGradient id=\"crossGlow\" cx=\"50%\" cy=\"50%\" r=\"50%\"\
        >\n          <stop offset=\"0%\" style=\"stop-color:#4fc3f7;stop-opacity:0.4\"\
        \ />\n          <stop offset=\"100%\" style=\"stop-color:#4fc3f7;stop-opacity:0\"\
        \ />\n        </radialGradient>\n      </defs>\n      <!-- Handle -->\n  \
        \    <path d=\"M35,25 Q35,15 50,15 Q65,15 65,25\" fill=\"none\" stroke=\"\
        url(#handleGrad)\" stroke-width=\"6\" stroke-linecap=\"round\" />\n      <!--\
        \ Main Body -->\n      <rect x=\"20\" y=\"25\" width=\"60\" height=\"50\"\
        \ rx=\"12\" ry=\"12\" fill=\"url(#kitBody)\" />\n      <!-- Reflection/Gloss\
        \ -->\n      <rect x=\"25\" y=\"30\" width=\"50\" height=\"15\" rx=\"8\" ry=\"\
        8\" fill=\"white\" opacity=\"0.4\" />\n      <!-- The Cross -->\n      <rect\
        \ x=\"46\" y=\"40\" width=\"8\" height=\"20\" rx=\"2\" fill=\"#4fc3f7\" />\n\
        \      <rect x=\"40\" y=\"46\" width=\"20\" height=\"8\" rx=\"2\" fill=\"\
        50\" r=\"18\" fill=\"url(#crossGlow)\" />\n    </svg>\n  `;\n  return `\n\
        \    <div style=\"width: 100%; height: 100%; display: flex; flex-direction:\
        \ column; align-items: center; justify-content: center; background: linear-gradient(135deg,\
        \ rgba(79, 195, 247, 0.15) 0%, rgba(20, 27, 38, 0) 100%); border-top-left-radius:\
        \ 20px; box-sizing: border-box; padding: 10px;\">\n      <div style=\"width:\
        \ 75px; height: 75px; display: flex; align-items: center; justify-content:\
        \ center; position: relative;\">\n        <div style=\"position: absolute;\
        \ width: 50px; height: 50px; background: #4fc3f7; border-radius: 50%; filter:\
        \ blur(25px); opacity: 0.5;\"></div>\n        <div style=\"position: relative;\
        \ z-index: 1;\">${svg}</div>\n      </div>\n      <div style=\"font-size:\
        \ 11px; font-weight: 900; color: white; text-align: center; line-height: 1.1;\
        \ letter-spacing: 0.8px; text-transform: uppercase;\">\n        SUIVI<br/>POST-GREFFE\n\
        \      </div>\n    </div>\n  `;\n]]]\n"
      details: "[[[\n  const start = new Date('2025-10-24T00:00:00');\n  const now\
        \ = new Date();\n  let months = (now.getFullYear() - start.getFullYear())\
        \ * 12 + (now.getMonth() - start.getMonth());\n  let days = now.getDate()\
        \ - start.getDate();\n  if (days < 0) {\n    months--;\n    const prevMonthLastDay\
        \ = new Date(now.getFullYear(), now.getMonth(), 0).getDate();\n    days +=\
        \ prevMonthLastDay;\n  }\n  \n  
        \ - start.getTime();\n  const jPlus = Math.floor(timeDiff / (1000 * 3600 *\
        \ 24));\n  \n  // Calcul \"Cela fera x mois dans x jours\"\n  let nextMonthMilestone\
        \ = new Date(start.getFullYear(), start.getMonth() + months + 1, start.getDate());\n\
        \  \n  // Corriger si le jour de greffe (ex: 24) n'existe pas dans le mois\
        \ cible (ex: février)\n  if (nextMonthMilestone.getDate() !== start.getDate())\
        \ {\n     nextMonthMilestone = new Date(nextMonthMilestone.getFullYear(),\
        \ nextMonthMilestone.getMonth(), 0);\n  }\n  \n  let daysUntilNextMonth =\
        \ Math.ceil((nextMonthMilestone.getTime() - now.getTime()) / (1000 * 3600\
        \ * 24));\n  \n  // Si c'est aujourd'hui le jour milestone\n  let futureText\
        \ = \"\";\n  if (now.getDate() === start.getDate()) {\n    futureText = `Cela\
        \ fait ${months} mois pile aujourd'hui !`;\n  } else {\n    futureText = `Cela\
        \ fera ${months + 1} mois dans ${daysUntilNextMonth} jours`;\n  }\n\n  let\
        \ confettis = \"\";\n  if (now.getDate() === 24) {\n    confettis = '<div\
        \ style=\"position:absolute; width:100%; height:100%; overflow:hidden; pointer-events:none;\
        \ z-index:0;\">';\n    for (let i = 0; i < 15; i++) {\n      const color =\
        \ [\"#FFD700\", \"#FF4500\", \"#ADFF2F\", \"#00BFFF\", \"#FF1493\"][i % 5];\n\
        \      const left = Math.floor(Math.random() * 100);\n      const delay =\
        \ (Math.random() * 2).toFixed(1);\n      confettis += `<div style=\"position:absolute;\
        \ width:4px; height:10px; background:${color}; left:${left}%; top:-20px; border-radius:2px;\
        \ animation: confetti-fall 3s linear infinite; animation-delay:${delay}s;\
        \ opacity:0.8;\"></div>`;\n    }\n    confettis += `\n      <style>\n    \
        \    @keyframes confetti-fall {\n          0% { transform: translateY(0) rotate(0deg);\
        \ opacity: 1; }\n          100% { transform: translateY(120px) rotate(360deg);\
        \ opacity: 0; }\n        }\n      </style></div>\n    `;\n  }\n\n  return\
        \ `\n    ${confettis}\n    <div style=\"width: 100%; height: 100%; display:\
        \ flex; flex-direction: column; justify-content: center; align-items: center;\
        \ padding: 0 15px; position: relative; z-index: 1;\">\n      <div style=\"\
        font-size: 32px; font-weight: 900; color: white; line-height: 1; text-shadow:\
        \ 0 0 10px rgba(255,255,255,0.2);\">J+${jPlus}</div>\n      <div style=\"\
        font-size: 13px; font-weight: 600; color: rgba(255,255,255,0.7); margin-top:2px;\
        \ text-transform:uppercase; letter-spacing:0.5px;\">${months} mois et ${days}\
        \ ${days > 1 ? \"jours\" : \"jour\"}</div>\n      \n      <div style=\"margin-top:\
        \ 10px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.05); width:\
        \ 80%; display: flex; justify-content: center;\">\n        <span style=\"\
        font-size: 10px; font-weight: 700; color: #4fc3f7; text-transform: uppercase;\
        \ letter-spacing: 0.5px;\">${futureText}</span>\n      </div>\n    </div>\n\
        \  `;\n]]]\n"
      footer: "[[[\n   return `\n     <div style=\"display:flex; width:100%; justify-content:center;\
        \ align-items:center;\">\n       <ha-icon icon=\"mdi:chevron-down\" style=\"\
        color: rgba(255,255,255,0.4); width: 24px; height: 24px; transition: all 0.3s\
        \ ease;\"></ha-icon>\n     </div>\n   `;\n]]]\n"
  entities:
  - type: custom:button-card
    entity: sensor.suivi_greffe_jour
    show_name: false
    show_icon: false
    styles:
      card:
      - background: none
      - box-shadow: none
      - border: none
      - padding: 0
      - margin-top: 10px
      grid:
      - grid-template-areas: '"tasks"'
      - grid-template-columns: 1fr
      - grid-template-rows: auto
      custom_fields:
        tasks:
        - width: 100%
    custom_fields:
      tasks: "[[[\n  if (!entity || !entity.attributes) return `<div style=\"padding:20px;color:rgba(255,255,255,0.5);\
        \ text-align:center;\">Chargement...</div>`;\n  var tasks = [\n    { key:\
        \ 'shampoing_aujourdhui', name: 'Shampoing', icon: 'mdi:shower', color: '#1e88e5'\
        \ },\n    { key: 'vitamine_aujourdhui', name: 'Vitamines', icon: 'mdi:pill-multiple',\
        \ color: '#2e7d32' },\n    { key: 'serum_ozone_aujourdhui', name: 'Sérum ozonée',\
        \ icon: 'mdi:beaker-outline', color: '#8e24aa' },\n    { key: 'dermaroller_serum_aujourdhui',\
        \ name: 'Dermaroller', icon: 'mdi:needle', color: '#fb8c00' },\n    { key:\
        \ 'huile_capillaire_aujourdhui', name: 'Huile', icon: 'mdi:eyedropper-variant',\
        \ color: '#6d4c41' },\n    { key: 'massage_cuir_chevelu_aujourdhui', name:\
        \ 'Massage', icon: 'mdi:hand-back-right', color: '#00897b' },\n    { key:\
        \ 'prp_aujourdhui', name: 'PRP', icon: 'mdi:hospital-marker', color: '#e91e63'\
        \ }\n  ];\n  \n  var titleHtml = `\n    <div style=\"width: 100%; text-align:\
        \ left; margin-bottom: 12px; padding-left: 4px;\">\n      <span style=\"font-size:\
        \ 11px; font-weight: 700; color: rgba(255,255,255,0.7); text-transform: uppercase;\
        \ letter-spacing: 1.5px;\">À FAIRE AUJOURD'HUI :</span>\n    </div>\n  `;\n\
        \  \n  var html = '<div style=\"display:flex; flex-wrap:wrap; gap:8px;\">';\n\
        \  var count = 0;\n  for (var i = 0; i < tasks.length; i++) {\n    var t =\
        \ tasks[i];\n    var val = entity.attributes[t.key];\n    if (val) {\n   \
        \   count++;\n      var displayVal = (val === true) ? 'À faire' : val;\n \
        \     html += '<div style=\"flex: 1 1 30%; min-width: 100px; height: 100px;\
        \ box-sizing: border-box; padding: 12px; border-radius: 20px; border: 1px\
        \ solid rgba(255,255,255,0.1); background: rgba(20, 27, 38, 0.4); backdrop-filter:\
        \ blur(10px); -webkit-backdrop-filter: blur(10px); box-shadow: 0 4px 15px\
        \ rgba(0,0,0,0.2); display: flex; flex-direction: column; align-items: center;\
        \ justify-content: center;\">'\n          + '<ha-icon icon=\"' + t.icon +\
        \ '\" style=\"--mdc-icon-size: 32px; color: ' + t.color + '; filter: drop-shadow(0\
        \ 0 8px ' + t.color + 'aa); margin-bottom: 8px;\"></ha-icon>'\n          +\
        \ '<div style=\"font-size: 13px; font-weight: 700; color: white;\">' + t.name\
        \ + '</div>'\n          + '<div style=\"font-size: 11px; font-weight: 500;\
        \ opacity: 0.7; margin-top: 4px; color: white;\">' + displayVal + '</div>'\n\
        \        + '</div>';\n    }\n  }\n  html += '</div>';\n  if (count === 0)\
        \ return '<div style=\"padding: 20px; text-align: center; color: rgba(255,255,255,0.7);\
        \ font-weight: 500;\">Rien à faire aujourd\\'hui ! \U0001F389</div>';\n  return\
        \ titleHtml + html;\n]]]\n"
