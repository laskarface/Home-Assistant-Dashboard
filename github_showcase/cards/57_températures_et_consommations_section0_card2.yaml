type: horizontal-stack
cards:
- type: custom:button-card
  entity: climate.hp_actuator_thermostat
  name: Pompe à Chaleur
  show_state: true
  show_icon: false
  aspect_ratio: 16/9
  styles:
    card:
    - padding: 0
    - border-radius: 24px
    - border: "[[[\n  const heating = states['binary_sensor.dhwp_actuator_energy_demand_status']?.state\
        \ === 'on';\n  return heating ? '1px solid rgba(255, 165, 0, 0.5)' : '1px\
        \ solid rgba(255,255,255,0.1)';\n]]]\n"
    - background: rgba(20, 27, 38, 0.6)
    - backdrop-filter: blur(20px)
    - -webkit-backdrop-filter: blur(20px)
    - box-shadow: "[[[\n  const heating = states['binary_sensor.dhwp_actuator_energy_demand_status']?.state\
        \ === 'on';\n  return heating \n    ? '0 0 20px rgba(255, 165, 0, 0.3), 0\
        \ 8px 32px rgba(0,0,0,0.3)' \n    : '0 8px 32px rgba(0,0,0,0.3)';\n]]]\n"
    - overflow: hidden
    - min-height: 220px
    - transition: all 0.5s ease
    name:
    - position: absolute
    - z-index: 2
    - top: 12px
    - left: 0
    - right: 0
    - text-align: center
    - font-size: 16px
    - font-weight: 700
    - letter-spacing: 0.5px
    - color: white
    - text-shadow: 0 2px 4px rgba(0,0,0,0.8)
    state:
    - position: absolute
    - z-index: 2
    - top: 34px
    - left: 0
    - right: 0
    - text-align: center
    - font-size: 13px
    - opacity: 0.8
    - font-weight: 500
    - color: rgba(255,255,255,0.9)
    - text-shadow: 0 2px 4px rgba(0,0,0,0.8)
    custom_fields:
      bg:
      - position: absolute
      - inset: 0
      - z-index: 0
      - opacity: 0.9
      - pointer-events: none
      overlay:
      - position: absolute
      - inset: 0
      - z-index: 1
      - background: linear-gradient(to bottom, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0) 30%,
          rgba(0,0,0,0) 70%, rgba(0,0,0,0.8) 100%)
      - pointer-events: none
      gauge_pac:
      - position: absolute
      - z-index: 3
      - left: 16px
      - top: 60px
      - bottom: 40px
      - width: 14px
      - border-radius: 10px
      - background: rgba(0,0,0,0.3)
      - border: 1px solid rgba(255,255,255,0.1)
      - box-shadow: 0 4px 10px rgba(0,0,0,0.3)
      gauge_ext:
      - position: absolute
      - z-index: 3
      - right: 16px
      - top: 60px
      - bottom: 40px
      - width: 14px
      - border-radius: 10px
      - background: rgba(0,0,0,0.3)
      - border: 1px solid rgba(255,255,255,0.1)
      - box-shadow: 0 4px 10px rgba(0,0,0,0.3)
      ext_label:
      - position: absolute
      - z-index: 4
      - right: 16px
      - bottom: 20px
      - font-size: 11px
      - font-weight: 600
      - color: rgba(255,255,255,0.8)
      - text-shadow: 0 1px 2px rgba(0,0,0,0.8)
      - text-align: center
      - width: 40px
      - margin-right: -13px
      temp:
      - position: absolute
      - z-index: 4
      - left: 50%
      - bottom: 35px
      - transform: translateX(-50%)
      - font-size: 28px
      - font-weight: 800
      - color: white
      - text-shadow: 0 4px 12px rgba(0,0,0,0.5)
      - letter-spacing: -0.5px
      consigne_inline:
      - position: absolute
      - z-index: 4
      - left: 50%
      - bottom: 15px
      - transform: translateX(-50%)
      - font-size: 12px
      - font-weight: 600
      - color: rgba(255,255,255,0.7)
      - background: rgba(0,0,0,0.3)
      - padding: 2px 8px
      - border-radius: 10px
      - border: 1px solid rgba(255,255,255,0.05)
  custom_fields:
    overlay: ''
    bg: "[[[\n  const demand = states['binary_sensor.dhwp_actuator_energy_demand_status'];\n\
      \  const heating = demand?.state === 'on';\n  const bust = (demand?.last_changed\
      \ || Date.now()).toString().replace(/\\D/g,'');\n  const src = heating\n   \
      \ ? `/local/pac_atlantic_heating_16_9_nostretch2.png?v=${bust}`\n    : `/local/pac_atlantic_idle_16_9_nostretch.png?v=${bust}`;\n\
      \  const zoom = heating ? 1.4 : 1.6;\n  const anim = heating ? 'animation: pulse_img_anim\
      \ 1.2s infinite alternate ease-in-out;' : '';\n  return `\n    <style>\n   \
      \   @keyframes pulse_img_anim {\n        0% { opacity: 0.35; filter: brightness(0.85);\
      \ }\n        100% { opacity: 1; filter: brightness(1.15); }\n      }\n    </style>\n\
      \    <div style=\"\n      width:100%; height:100%;\n      background: url('${src}')\
      \ center/contain no-repeat;\n      transform: scale(${zoom});\n      transform-origin:\
      \ center;\n      transition: transform 0.5s ease;\n      ${anim}\n    \"></div>\n\
      \  `;\n]]]\n"
    temp: "[[[\n  var s = states['sensor.hp_actuator_io_5470820_9_temperature'];\n\
      \  var tRaw = s ? s.state : '—';\n  var t = parseFloat(tRaw.toString().replace(',',\
      \ '.'));\n  return (isFinite(t) ? t.toFixed(1) : '—') + '°';\n]]]\n"
    consigne_inline: "[[[\n  var sRaw = entity && entity.attributes && entity.attributes.temperature\
      \ ? entity.attributes.temperature : '—';\n  var s = parseFloat(sRaw.toString().replace(',',\
      \ '.'));\n  return 'Cible ' + (isFinite(s) ? s.toFixed(0) : '—') + '°';\n]]]\n"
    ext_label: "[[[\n  var s = states['sensor.hp_actuator_io_5470820_3_temperature'];\n\
      \  var eRaw = s ? s.state : '—';\n  var e = parseFloat(eRaw.toString().replace(',',\
      \ '.'));\n  return 'Ext\\n' + (isFinite(e) ? e.toFixed(1) : '—') + '°';\n]]]\n"
    gauge_pac: "[[[\n  var s = states['sensor.hp_actuator_io_5470820_9_temperature'];\n\
      \  var tRaw = s ? s.state : '—';\n  var t = parseFloat(tRaw.toString().replace(',',\
      \ '.'));\n  var min = -10, max = 38;\n  var safeT = isFinite(t) ? t : min;\n\
      \  var pct = Math.max(0, Math.min(100, ((safeT - min) / (max - min)) * 100));\n\
      \  var color = 'rgba(255,255,255,0.9)';\n  if (safeT <= 7) color = '#78EBFF';\n\
      \  else if (safeT < 19) color = '#008CFF';\n  else if (safeT <= 25) color =\
      \ '#46D278';\n  else if (safeT <= 31) color = '#FFDC78';\n  else color = '#DC5050';\n\
      \  return '<div style=\"width:100%; height:100%; position:relative; border-radius:10px;\
      \ overflow:hidden;\"><div style=\"position:absolute; bottom:0; left:0; right:0;\
      \ height:' + pct + '%; background:' + color + '; transition: all 1s cubic-bezier(0.4,0,0.2,1);\
      \ box-shadow: 0 0 10px ' + color + ';\"></div></div>';\n]]]\n"
    gauge_ext: "[[[\n  var s = states['sensor.hp_actuator_io_5470820_3_temperature'];\n\
      \  var eRaw = s ? s.state : '—';\n  var e = parseFloat(eRaw.toString().replace(',',\
      \ '.'));\n  var min = -10, max = 38;\n  var safeT = isFinite(e) ? e : min;\n\
      \  var pct = Math.max(0, Math.min(100, ((safeT - min) / (max - min)) * 100));\n\
      \  var color = '#ffffff';\n  if (safeT <= 5) color = '#78EBFF';\n  else if (safeT\
      \ <= 15) color = '#008CFF';\n  else if (safeT <= 25) color = '#46D278';\n  else\
      \ if (safeT <= 30) color = '#FFDC78';\n  else color = '#DC5050';\n  return '<div\
      \ style=\"width:100%; height:100%; position:relative; border-radius:10px; overflow:hidden;\"\
      ><div style=\"position:absolute; bottom:0; left:0; right:0; height:' + pct +\
      \ '%; background:' + color + '; transition: all 1s cubic-bezier(0.4,0,0.2,1);\
      \ box-shadow: 0 0 10px ' + color + ';\"></div></div>';\n]]]\n"
  extra_styles: "@keyframes pulse_img_anim {\n  0% { opacity: 0.4; filter: brightness(0.8);\
    \ }\n  100% { opacity: 1; filter: brightness(1.2); }\n}\n"
- type: custom:button-card
  entity: water_heater.temperature_ballon
  name: Ballon Thermor
  show_state: true
  show_icon: false
  styles:
    card:
    - padding: 0
    - border-radius: 24px
    - border: "[[[\n  const heating = states['binary_sensor.dhwp_actuator_energy_demand_status']?.state\
        \ === 'on';\n  return heating ? '1px solid rgba(255, 165, 0, 0.5)' : '1px\
        \ solid rgba(255,255,255,0.1)';\n]]]\n"
    - background: rgba(20, 27, 38, 0.6)
    - backdrop-filter: blur(20px)
    - -webkit-backdrop-filter: blur(20px)
    - box-shadow: "[[[\n  const heating = states['binary_sensor.dhwp_actuator_energy_demand_status']?.state\
        \ === 'on';\n  return heating \n    ? '0 0 20px rgba(255, 165, 0, 0.3), 0\
        \ 8px 32px rgba(0,0,0,0.3)' \n    : '0 8px 32px rgba(0,0,0,0.3)';\n]]]\n"
    - overflow: hidden
    - min-height: 220px
    - transition: all 0.5s ease
    name:
    - position: absolute
    - z-index: 2
    - top: 12px
    - left: 0
    - right: 0
    - text-align: center
    - font-size: 16px
    - font-weight: 700
    - letter-spacing: 0.5px
    - color: white
    - text-shadow: 0 2px 4px rgba(0,0,0,0.8)
    state:
    - position: absolute
    - z-index: 2
    - top: 34px
    - left: 0
    - right: 0
    - text-align: center
    - font-size: 13px
    - opacity: 0.8
    - font-weight: 500
    - color: rgba(255,255,255,0.9)
    - text-shadow: 0 2px 4px rgba(0,0,0,0.8)
    custom_fields:
      bg:
      - position: absolute
      - inset: 0
      - z-index: 0
      - animation: "[[[\n  return (states['binary_sensor.dhwp_actuator_energy_demand_status']?.state\
          \ === 'on')\n  ? 'pulse 1.5s infinite alternate ease-in-out'\n  : 'none';\n\
          ]]]\n"
      overlay:
      - position: absolute
      - inset: 0
      - z-index: 1
      - background: linear-gradient(to bottom, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0) 30%,
          rgba(0,0,0,0) 70%, rgba(0,0,0,0.8) 100%)
      gauge_temp_ballon:
      - position: absolute
      - z-index: 3
      - left: 16px
      - top: 60px
      - bottom: 40px
      - width: 14px
      - border-radius: 10px
      - background: rgba(0,0,0,0.3)
      - border: 1px solid rgba(255,255,255,0.1)
      - box-shadow: 0 4px 10px rgba(0,0,0,0.3)
      gauge:
      - position: absolute
      - z-index: 3
      - right: 16px
      - top: 60px
      - bottom: 40px
      - width: auto
      - display: flex
      - gap: 4px
      - align-items: flex-end
      max_label:
      - position: absolute
      - z-index: 4
      - right: 6px
      - top: 56%
      - transform: translateY(-50%) rotate(-90deg)
      - font-size: 12px
      - font-weight: 600
      - color: rgba(255,255,255,0.6)
      - text-align: center
      - width: 80px
      - opacity: 0.8
      temp:
      - position: absolute
      - z-index: 4
      - left: 50%
      - bottom: 35px
      - transform: translateX(-50%)
      - font-size: 28px
      - font-weight: 800
      - color: white
      - text-shadow: 0 4px 12px rgba(0,0,0,0.5)
      - letter-spacing: -0.5px
      conso_inline:
      - position: absolute
      - z-index: 4
      - left: 50%
      - bottom: 15px
      - transform: translateX(-50%)
      - font-size: 12px
      - font-weight: 600
      - color: rgba(255,255,255,0.7)
      - background: rgba(0,0,0,0.4)
      - padding: 2px 8px
      - border-radius: 10px
      - border: 1px solid rgba(255,255,255,0.05)
  custom_fields:
    overlay: ''
    bg: "[[[\n  const heating = states['binary_sensor.dhwp_actuator_energy_demand_status']?.state\
      \ === 'on';\n  const bust = (states['binary_sensor.dhwp_actuator_energy_demand_status']?.last_changed\
      \ || Date.now()).toString().replace(/\\D/g,'');\n  const src = heating \n  \
      \  ? `/local/ballon_thermore_200l_heating.png?v=${bust}` \n    : `/local/ballon_thermore_200l.png?v=${bust}`;\n\
      \  const anim = heating ? 'animation: pulse_ballon 1.2s infinite alternate ease-in-out;'\
      \ : '';\n  return `\n    <style>\n      @keyframes pulse_ballon {\n        0%\
      \ { opacity: 0.35; filter: brightness(0.85); }\n        100% { opacity: 1; filter:\
      \ brightness(1.15); }\n      }\n    </style>\n    <div style=\"\n      width:100%;\
      \ height:100%;\n      background:url('${src}') center/contain no-repeat;\n \
      \     transform: scale(0.85);\n      transform-origin: center;\n      ${anim}\n\
      \    \"></div>\n  `;\n]]]\n"
    temp: "[[[\n  const tRaw = (entity?.attributes?.current_temperature ?? entity?.attributes?.temperature\
      \ ?? '—').toString().replace(',', '.');\n  const t = parseFloat(tRaw);\n  return\
      \ `${(isFinite(t) ? t.toFixed(1) : '—')}°`;\n]]]\n"
    conso_inline: "[[[\n  const raw = (states['sensor.eau_chaude_du_jour_calculee']?.state\
      \ ?? '0').toString().replace(',', '.');\n  const v = parseFloat(raw) || 0;\n\
      \  return `${v.toFixed(0)} L / jour`;\n]]]\n"
    max_label: "[[[\n  const raw = (states['sensor.eau_chaude_du_jour_calculee']?.state\
      \ ?? '0').toString().replace(',', '.');\n  const v = parseFloat(raw) || 0;\n\
      \  let max = 200;\n  let color = 'rgba(255,255,255,0.6)';\n  if (v >= 400) {\n\
      \    max = 600;\n    color = '#DC4646'; // Red\n  } else if (v >= 200) {\n \
      \   max = 400;\n    color = '#FFA500'; // Orange\n  }\n  return `<span style=\"\
      color: ${color}; transition: color 0.5s ease;\">Max ${max} L</span>`;\n]]]\n"
    gauge_temp_ballon: "[[[\n  const tRaw = (entity?.attributes?.current_temperature\
      \ ?? entity?.attributes?.temperature ?? '—').toString().replace(',', '.');\n\
      \  const t = parseFloat(tRaw);\n  const min = 20, max = 65;\n  const safeT =\
      \ isFinite(t) ? t : min;\n  const pct = Math.max(0, Math.min(100, ((safeT -\
      \ min) / (max - min)) * 100));\n  \n  let color = '#ffffff';\n  if (safeT <=\
      \ 35) color = '#008CFF';\n  else if (safeT <= 45) color = '#FFD700';\n  else\
      \ if (safeT <= 55) color = '#FF8C00';\n  else color = '#DC4646';\n  return `\n\
      \    <div style=\"width:100%; height:100%; position:relative; border-radius:10px;\
      \ overflow:hidden;\">\n      <div style=\"position:absolute; bottom:0; left:0;\
      \ right:0; height:${pct}%; background:${color}; box-shadow: 0 0 12px ${color};\
      \ transition: all 1s ease;\"></div>\n    </div>\n  `;\n]]]\n"
    gauge: "[[[\n  const raw = (states['sensor.eau_chaude_du_jour_calculee']?.state\
      \ ?? '0').toString().replace(',', '.');\n  let v = parseFloat(raw) || 0;\n \
      \ \n  let color = '#00B4FF'; // Default Blue\n  if (v >= 400) color = '#DC4646';\
      \ // Red\n  else if (v >= 200) color = '#FFA500'; // Orange\n  \n  const barStyle\
      \ = (height) => `\n    width: 14px; \n    height: 100%; \n    position: relative;\
      \ \n    border-radius: 10px; \n    background: rgba(0,0,0,0.3); \n    border:\
      \ 1px solid rgba(255,255,255,0.1);\n    overflow: hidden;\n  `;\n  \n  const\
      \ innerStyle = (pct) => `\n    position: absolute; \n    bottom: 0; left: 0;\
      \ right: 0; \n    height: ${pct}%; \n    background: ${color}; \n    box-shadow:\
      \ 0 0 10px ${color}; \n    transition: height 0.8s ease;\n  `;\n  \n  let gaugeOutput\
      \ = '';\n  \n  // Jauge 1 (0-200)\n  let p1 = Math.max(0, Math.min(100, (v /\
      \ 200) * 100));\n  gaugeOutput += `<div style=\"${barStyle()}\"><div style=\"\
      ${innerStyle(p1)}\"></div></div>`;\n  \n  // Jauge 2 (200-400)\n  if (v >= 200)\
      \ {\n    let p2 = Math.max(0, Math.min(100, ((v - 200) / 200) * 100));\n   \
      \ gaugeOutput += `<div style=\"${barStyle()}\"><div style=\"${innerStyle(p2)}\"\
      ></div></div>`;\n  }\n  \n  // Jauge 3 (400-600)\n  if (v >= 400) {\n    let\
      \ p3 = Math.max(0, Math.min(100, ((v - 400) / 200) * 100));\n    gaugeOutput\
      \ += `<div style=\"${barStyle()}\"><div style=\"${innerStyle(p3)}\"></div></div>`;\n\
      \  }\n  \n  return gaugeOutput;\n]]]\n"
  extra_styles: "@keyframes pulse {\n  0% { opacity: 0.3; }\n  100% { opacity: 1;\
    \ }\n}\n"
