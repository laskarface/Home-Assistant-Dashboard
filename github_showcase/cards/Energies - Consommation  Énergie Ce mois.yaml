# CARD: Energies - Consommation  Énergie Ce mois
# PREREQUISITES:
#   ENTITIES:
#     - sensor.battery_charge_mois
#     - sensor.battery_discharge_mois
#     - sensor.ecojoko_consommation_mois
#     - sensor.grid_return_mois
#   HACS / UI COMPONENTS:
#     - button-card
#----------------------------------------

type: custom:button-card
name: Consommation & Énergie (Ce mois)
styles:
  card:
  - background: rgba(20, 27, 38, 0.6)
  - backdrop-filter: blur(10px)
  - -webkit-backdrop-filter: blur(10px)
  - border-radius: 24px
  - border: 1px solid rgba(255,255,255,0.1)
  - box-shadow: 0 8px 32px rgba(0,0,0,0.3)
  - padding: 20px
  grid:
  - grid-template-areas: '"n" "table"'
  - grid-template-rows: auto auto
  name:
  - font-size: 16px
  - font-weight: 700
  - color: rgba(255,255,255,0.9)
  - margin-bottom: 20px
  - text-align: left
  - justify-self: start
custom_fields:
  table:
    card:
      type: custom:button-card
      styles:
        card:
        - background: transparent
        - border: none
        - box-shadow: none
        - padding: 0
        grid:
        - grid-template-areas: '"header" "reseau" "batterie"'
        - grid-template-columns: 1fr
      custom_fields:
        header: "[[[\n  return `\n    <div style=\"display: grid; grid-template-columns:\
          \ 1fr 100px 100px; padding: 0 10px 10px 10px; border-bottom: 1px solid rgba(255,255,255,0.1);\
          \ font-size: 11px; font-weight: 600; color: rgba(255,255,255,0.5); text-transform:\
          \ uppercase; letter-spacing: 1px;\">\n      <div>Source</div>\n      <div\
          \ style=\"text-align: right;\">Injecté</div>\n      <div style=\"text-align:\
          \ right;\">Consommé</div>\n    </div>\n  `;\n]]]\n"
        reseau: "[[[\n  const c = parseFloat(states['sensor.ecojoko_consommation_mois']?.state)\
          \ || 0;\n  const r = parseFloat(states['sensor.grid_return_mois']?.state)\
          \ || 0;\n  return `\n    <div style=\"display: grid; grid-template-columns:\
          \ 1fr 100px 100px; padding: 15px 10px; border-bottom: 1px solid rgba(255,255,255,0.05);\
          \ align-items: center;\">\n      <div style=\"display: flex; align-items:\
          \ center; gap: 10px;\">\n        <div style=\"color: #00B4FF; display: flex;\"\
          ><ha-icon icon=\"mdi:transmission-tower\" style=\"--mdc-icon-size: 20px;\"\
          ></ha-icon></div>\n        <div style=\"font-size: 14px; font-weight: 600;\
          \ color: rgba(255,255,255,0.9);\">Réseau</div>\n      </div>\n      <div\
          \ style=\"text-align: right; font-size: 14px; font-weight: 700; color: rgba(255,255,255,0.9);\"\
          >${r === 0 ? '—' : r.toFixed(1) + ' kWh'}</div>\n      <div style=\"text-align:\
          \ right; font-size: 14px; font-weight: 700; color: #00B4FF;\">${c.toFixed(1)}\
          \ kWh</div>\n    </div>\n  `;\n]]]\n"
        batterie: "[[[\n  const ch = states['sensor.battery_charge_mois']?.state;\n\
          \  if (!ch || ch === 'unavailable' || ch === 'unknown') return `<div style=\"\
          display:none\"></div>`;\n  const dch = parseFloat(states['sensor.battery_discharge_mois']?.state)\
          \ || 0;\n  const chVal = parseFloat(ch) || 0;\n  return `\n    <div style=\"\
          display: grid; grid-template-columns: 1fr 100px 100px; padding: 15px 10px;\
          \ align-items: center;\">\n      <div style=\"display: flex; align-items:\
          \ center; gap: 10px;\">\n        <div style=\"color: #00FF00; display: flex;\"\
          ><ha-icon icon=\"mdi:battery-high\" style=\"--mdc-icon-size: 20px;\"></ha-icon></div>\n\
          \        <div style=\"font-size: 14px; font-weight: 600; color: rgba(255,255,255,0.9);\"\
          >Batterie</div>\n      </div>\n      <div style=\"text-align: right; font-size:\
          \ 14px; font-weight: 700; color: rgba(255,255,255,0.9);\">${chVal.toFixed(1)}\
          \ kWh</div>\n      <div style=\"text-align: right; font-size: 14px; font-weight:\
          \ 700; color: #00FF00;\">${dch.toFixed(1)} kWh</div>\n    </div>\n  `;\n\
          ]]]\n"
