# CARD: Imprimante 3D - Ratrig Vminion Fan Speed
# PREREQUISITES:
#   HACS / UI COMPONENTS:
#     - button-card
#     - mod-card
#----------------------------------------

type: custom:mod-card
card_mod:
  style: "ha-card{\n  border-radius: 6px;\n  overflow: hidden;\n  padding: 12px;\n\
    \  position: relative;\n  background: linear-gradient(160deg,#141b26 0%,#111826\
    \ 45%,#0d121c 100%) !important;\n  box-shadow: 0 10px 22px rgba(0,0,0,0.65) !important;\n\
    \  border: 1px solid rgba(255,255,255,0.04) !important;\n}\nha-card:before{\n\
    \  content:\"\";\n  position:absolute;\n  inset:0;\n  background: radial-gradient(circle\
    \ at top left,rgba(255,255,255,0.14),transparent 60%);\n  pointer-events:none;\n\
    \  z-index:0;\n}\n"
card:
  type: custom:button-card
  entity: number.ratrig_vminion_fan_speed
  show_icon: false
  show_name: false
  show_state: false
  styles:
    card:
    - background: transparent
    - border: none
    - box-shadow: none
    - padding: 0
    - height: 76px
    grid:
    - grid-template-areas: '"top" "slider"'
    - grid-template-columns: 1fr
    - grid-template-rows: min-content min-content
    - row-gap: 10px
    custom_fields:
      top:
      - width: 100%
      slider:
      - width: 100%
  custom_fields:
    top: "[[[\n  const raw = states['number.ratrig_vminion_fan_speed']?.state ?? '0';\n\
      \  const n = Number(String(raw).replace(',', '.'));\n  const v = Number.isFinite(n)\
      \ ? Math.round(n) : 0;\n\n  return `\n    <div style=\"width:100%;display:flex;align-items:center;justify-content:space-between;\"\
      >\n      <div style=\"display:flex;align-items:center;gap:10px;min-width:0;\"\
      >\n        <ha-icon icon=\"mdi:fan\" style=\"\n          width:22px;height:22px;flex:0\
      \ 0 auto;\n          color: rgba(255,255,255,0.92);\n          filter: drop-shadow(0\
      \ 0 8px rgba(255,255,255,0.15));\n        \"></ha-icon>\n        <div style=\"\
      \n          white-space:nowrap;overflow:hidden;text-overflow:ellipsis;\n   \
      \       font-size:13px;font-weight:800;\n          color: rgba(255,255,255,0.95);\n\
      \          text-shadow: 0 2px 10px rgba(0,0,0,0.8);\n        \">Material Fan</div>\n\
      \      </div>\n\n      <div style=\"\n        font-size:13px;font-weight:900;\n\
      \        color: rgba(255,255,255,0.95);\n        text-shadow: 0 2px 10px rgba(0,0,0,0.8);\n\
      \      \">${v} %</div>\n    </div>\n  `;\n]]]\n"
    slider: "[[[\n  const ent = 'number.ratrig_vminion_fan_speed';\n  const raw =\
      \ states[ent]?.state ?? '0';\n  const n = Number(String(raw).replace(',', '.'));\n\
      \  const v = Number.isFinite(n) ? Math.max(0, Math.min(100, Math.round(n)))\
      \ : 0;\n\n  const bg = `linear-gradient(90deg,\n    rgba(0,170,255,0.95) 0%,\n\
      \    rgba(0,170,255,0.95) ${v}%,\n    rgba(255,255,255,0.12) ${v}%,\n    rgba(255,255,255,0.12)\
      \ 100%)`;\n\n  return `\n    <div style=\"\n      width:100%;\n      padding:\
      \ 10px 2px 12px;   /* + bas pour le thumb */\n      overflow: visible;     \
      \   /* important */\n      box-sizing: border-box;\n    \">\n      <input\n\
      \        type=\"range\"\n        min=\"0\"\n        max=\"100\"\n        step=\"\
      1\"\n        value=\"${v}\"\n        style=\"\n          width:100%;\n     \
      \     -webkit-appearance:none;\n          appearance:none;\n          height:8px;\n\
      \          border-radius:999px;\n          background:${bg};\n          outline:none;\n\
      \          margin:0;\n          overflow: visible;\n        \"\n        oninput=\"\
      \n          const val = Number(this.value);\n          this.style.background\
      \ = 'linear-gradient(90deg, rgba(0,170,255,0.95) 0%, rgba(0,170,255,0.95) '\
      \ + val + '%, rgba(255,255,255,0.12) ' + val + '%, rgba(255,255,255,0.12) 100%)';\n\
      \        \"\n        onchange=\"\n          const val = Number(this.value);\n\
      \          this.getRootNode().host.dispatchEvent(new CustomEvent('hass-call-service',\
      \ {\n            bubbles:true, composed:true,\n            detail:{ domain:'number',\
      \ service:'set_value', serviceData:{ entity_id:'${ent}', value: val } }\n  \
      \        }));\n        \"\n      />\n      <style>\n        input[type=range]::-webkit-slider-thumb{\n\
      \          -webkit-appearance:none; appearance:none;\n          width:18px;height:18px;border-radius:50%;\n\
      \          background: rgba(255,255,255,0.95);\n          box-shadow: 0 6px\
      \ 14px rgba(0,0,0,0.45);\n          border: 1px solid rgba(255,255,255,0.25);\n\
      \          margin-top: -5px; /* centre le thumb sur la piste */\n        }\n\
      \        input[type=range]::-moz-range-thumb{\n          width:18px;height:18px;border-radius:50%;\n\
      \          background: rgba(255,255,255,0.95);\n          box-shadow: 0 6px\
      \ 14px rgba(0,0,0,0.45);\n          border: 1px solid rgba(255,255,255,0.25);\n\
      \        }\n        input[type=range]::-moz-range-track{\n          height:8px;\n\
      \          border-radius:999px;\n          background: transparent;\n      \
      \  }\n      </style>\n    </div>\n  `;\n]]]\n"
