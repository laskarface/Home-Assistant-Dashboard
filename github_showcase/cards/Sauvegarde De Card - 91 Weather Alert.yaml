type: custom:fold-entity-row
padding: 0
clickable: true
card_mod:
  style: "{% set st = states('sensor.91_weather_alert') %}\n{% if st == 'Vert' or\
    \ st == 'unknown' or st == 'unavailable' %}\n  :host {\n    display: none !important;\n\
    \  }\n{% endif %}\n\ndiv#head {\n  display: block !important;\n  width: 100% !important;\n\
    \  padding: 0 !important;\n  margin: 0 !important;\n  --toggle-icon-width: 0px\
    \ !important;\n}\n#head {\n  padding: 0 !important;\n  margin: 0 !important;\n\
    \  width: 100% !important;\n  cursor: pointer !important;\n  pointer-events: auto\
    \ !important;\n}\n#head ha-icon {\n  display: none !important;\n  width: 0px !important;\n\
    }\ndiv#items {\n  padding: 0 !important;\n  margin: 0 !important;\n}\n"
head:
  type: custom:button-card
  entity: sensor.91_weather_alert
  show_name: false
  show_icon: false
  show_state: false
  tap_action:
    action: none
  styles:
    card:
    - padding: 0
    - border-radius: 20px
    - background: rgba(20, 27, 38, 0.6)
    - backdrop-filter: blur(20px)
    - -webkit-backdrop-filter: blur(20px)
    - box-shadow: "[[[\n  if (!entity || !entity.attributes) return '0 8px 32px rgba(0,0,0,0.3)';\n\
        \  const p_list = ['Vent violent', 'Pluie-inondation', 'Orages', 'Inondation',\
        \ 'Neige-verglas', 'Canicule', 'Grand froid', 'Avalanches', 'Vagues-submersion'];\n\
        \  let max_lvl = 'Jaune';\n  let found = false;\n  for (const p of p_list)\
        \ {\n    if (entity.attributes[p] === 'Rouge') { max_lvl = 'Rouge'; found=true;\
        \ break; }\n    if (entity.attributes[p] === 'Orange') { max_lvl = 'Orange';\
        \ found=true; }\n    if (entity.attributes[p] === 'Jaune' && !found) { found=true;\
        \ }\n  }\n  if (max_lvl === 'Rouge') return '0 0 20px rgba(244, 67, 54, 0.4),\
        \ 0 8px 32px rgba(0,0,0,0.3)';\n  if (max_lvl === 'Orange') return '0 0 20px\
        \ rgba(255, 152, 0, 0.4), 0 8px 32px rgba(0,0,0,0.3)';\n  return '0 0 15px\
        \ rgba(255, 235, 59, 0.3), 0 8px 32px rgba(0,0,0,0.3)';\n]]]\n"
    - border: "[[[\n  if (!entity || !entity.attributes) return '1px solid rgba(255,255,255,0.1)';\n\
        \  const p_list = ['Vent violent', 'Pluie-inondation', 'Orages', 'Inondation',\
        \ 'Neige-verglas', 'Canicule', 'Grand froid', 'Avalanches', 'Vagues-submersion'];\n\
        \  let max_lvl = 'Jaune';\n  let found = false;\n  for (const p of p_list)\
        \ {\n    if (entity.attributes[p] === 'Rouge') { max_lvl = 'Rouge'; found=true;\
        \ break; }\n    if (entity.attributes[p] === 'Orange') { max_lvl = 'Orange';\
        \ found=true; }\n    if (entity.attributes[p] === 'Jaune' && !found) { found=true;\
        \ }\n  }\n  if (max_lvl === 'Rouge') return '1px solid rgba(244, 67, 54, 0.5)';\n\
        \  if (max_lvl === 'Orange') return '1px solid rgba(255, 152, 0, 0.5)';\n\
        \  return '1px solid rgba(255, 235, 59, 0.4)';\n]]]\n"
    - transition: all 0.5s ease
    grid:
    - grid-template-areas: '"icon details" "footer footer"'
    - grid-template-columns: 130px 1fr
    - grid-template-rows: 60px 30px
    - gap: 0px
    - width: 100%
    - margin: 0
    custom_fields:
      icon:
      - justify-self: stretch
      - align-self: stretch
      - border-right: 2px solid rgba(255,255,255,0.6)
      - border-top-left-radius: 20px
      - display: flex
      - align-items: center
      - justify-content: center
      - padding: 0
      details:
      - justify-self: stretch
      - align-self: stretch
      - display: flex
      - flex-direction: column
      - justify-content: center
      - align-items: stretch
      - padding: 0 0 0 20px
      - overflow: hidden
      - position: relative
      footer:
      - justify-self: stretch
      - align-self: stretch
      - background: rgba(0,0,0,0.2)
      - border-top: 1px solid rgba(255,255,255,0.05)
      - display: flex
      - align-items: center
      - justify-content: center
      - border-radius: 0 0 20px 20px
  custom_fields:
    icon: "[[[\n  if (!entity || !entity.attributes) return \"\";\n  const p_list\
      \ = ['Vent violent', 'Pluie-inondation', 'Orages', 'Inondation', 'Neige-verglas',\
      \ 'Canicule', 'Grand froid', 'Avalanches', 'Vagues-submersion'];\n  let max_lvl\
      \ = 'Jaune';\n  let found = false;\n  \n  for (const p of p_list) {\n    if\
      \ (entity.attributes[p] === 'Rouge') { max_lvl = 'Rouge'; found=true; break;\
      \ }\n    if (entity.attributes[p] === 'Orange') { max_lvl = 'Orange'; found=true;\
      \ }\n    if (entity.attributes[p] === 'Jaune' && !found) { found=true; }\n \
      \ }\n  \n  let color = '#ffeb3b'; // Jaune\n  if (max_lvl === 'Orange') color\
      \ = '#ff9800';\n  if (max_lvl === 'Rouge') color = '#f44336';\n  \n  return\
      \ `\n    <div style=\"width: 100%; height: 100%; display: flex; align-items:\
      \ center; justify-content: center; background: linear-gradient(135deg, ${color}33\
      \ 0%, ${color}0D 100%); border-top-left-radius: 20px;\">\n      <svg viewBox=\"\
      0 0 24 24\" style=\"width: 38px; height: 38px; filter: drop-shadow(0 0 8px ${color}80);\"\
      >\n        <g style=\"animation: pulse_alert 2s infinite;\">\n          <circle\
      \ cx=\"12\" cy=\"12\" r=\"10\" fill=\"none\" stroke=\"${color}\" stroke-width=\"\
      1.5\" stroke-dasharray=\"4 6\" stroke-linecap=\"round\" style=\"transform-origin:\
      \ 50% 50%; animation: spin_radar 12s linear infinite;\" />\n          <circle\
      \ cx=\"12\" cy=\"12\" r=\"7\" fill=\"${color}33\" stroke=\"${color}\" stroke-width=\"\
      1\" opacity=\"0.6\"/>\n          <path d=\"M12 7V13\" stroke=\"${color}\" stroke-width=\"\
      2.5\" stroke-linecap=\"round\" />\n          <circle cx=\"12\" cy=\"16.5\" r=\"\
      1.5\" fill=\"${color}\" />\n        </g>\n      </svg>\n    </div>\n    <style>\
      \ @keyframes spin_radar { 100% { transform: rotate(360deg); } } </style>\n \
      \ `;\n]]]\n"
    details: "[[[\n  if (!entity || !entity.attributes) return \"\";\n  \n  const\
      \ pheno_configs = [\n    { id: 'Vent violent', icon: 'mdi:weather-windy' },\n\
      \    { id: 'Pluie-inondation', icon: 'mdi:weather-pouring' },\n    { id: 'Orages',\
      \ icon: 'mdi:weather-lightning' },\n    { id: 'Inondation', icon: 'mdi:home-flood'\
      \ },\n    { id: 'Neige-verglas', icon: 'mdi:weather-snowy' },\n    { id: 'Canicule',\
      \ icon: 'mdi:weather-sunny-alert' },\n    { id: 'Grand froid', icon: 'mdi:snowflake'\
      \ },\n    { id: 'Avalanches', icon: 'mdi:image-filter-hdr' },\n    { id: 'Vagues-submersion',\
      \ icon: 'mdi:waves' }\n  ];\n  \n  const p_colors = { 'Rouge': '#f44336', 'Orange':\
      \ '#ff9800', 'Jaune': '#ffeb3b', 'Vert': 'rgba(255,255,255,0.2)' };\n  \n  let\
      \ icons_html = '<div style=\"display: flex; gap: 4px; align-items: center; justify-content:\
      \ flex-start; width: 100%;\">';\n  \n  pheno_configs.forEach(conf => {\n   \
      \ let lvl = entity.attributes[conf.id];\n    if (!lvl || lvl === 'Vert') {\n\
      \       icons_html += `<ha-icon icon=\"${conf.icon}\" style=\"color: rgba(255,255,255,0.15);\
      \ width: 22px; height: 22px;\"></ha-icon>`;\n    } else {\n       const c =\
      \ p_colors[lvl] || p_colors['Jaune'];\n       icons_html += `<ha-icon icon=\"\
      ${conf.icon}\" style=\"color: ${c}; filter: drop-shadow(0 0 5px ${c}80); width:\
      \ 22px; height: 22px; animation: dash_blink_text 1.5s infinite;\"></ha-icon>`;\n\
      \    }\n  });\n  \n  icons_html += '</div>';\n\n  return `\n    <div style=\"\
      display: flex; flex-direction: column; justify-content: center; align-items:\
      \ flex-start; gap: 4px;\">\n      <div style=\"font-size: 15px; font-weight:\
      \ 900; color: white; text-transform: uppercase; letter-spacing: 1px; text-shadow:\
      \ 0 0 10px rgba(255,255,255,0.2);\">Alertes Météo</div>\n      ${icons_html}\n\
      \    </div>\n  `;\n]]]\n"
    footer: "[[[\n   setTimeout(() => {\n     const isEditMode = window.location.search.includes('edit=1')\
      \ || window.location.pathname.includes('edit');\n     if (isEditMode) {\n  \
      \      const el = document.querySelector(\"hui-conditional-card\"); \n     \
      \   if (el) el.style.display = 'block';\n     }\n   }, 1000);\n\n   return (function()\
      \ {\n     return `\n       <div style=\"display:flex; width:100%; justify-content:center;\
      \ align-items:center;\">\n         <ha-icon icon=\"mdi:chevron-down\" style=\"\
      color: rgba(255,255,255,0.7); width: 18px; height: 18px;\"></ha-icon>\n    \
      \   </div>\n     `;\n   })();\n]]]\n"
  extra_styles: "@keyframes dash_blink_text {\n  0% { opacity: 1; transform: scale(1);\
    \ }\n  50% { opacity: 0.6; transform: scale(1.1); }\n  100% { opacity: 1; transform:\
    \ scale(1); }\n}\n@keyframes pulse_alert {\n  0% { filter: drop-shadow(0 0 10px\
    \ rgba(255, 255, 255, 0.2)) drop-shadow(0 0 5px inherit); transform: scale(1);\
    \ }\n  50% { filter: drop-shadow(0 0 20px inherit) drop-shadow(0 0 10px inherit);\
    \ transform: scale(1.1); }\n  100% { filter: drop-shadow(0 0 10px rgba(255, 255,\
    \ 255, 0.2)) drop-shadow(0 0 5px inherit); transform: scale(1); }\n}\n"
entities:
- type: custom:button-card
  entity: sensor.91_weather_alert
  show_name: false
  show_icon: false
  show_state: false
  styles:
    card:
    - background: transparent
    - border: none
    - box-shadow: none
    - padding: 0px
    - margin-top: 10px
    grid:
    - grid-template-areas: '"alerts_text"'
    - grid-template-columns: 1fr
  custom_fields:
    alerts_text: "[[[\n  if (!entity || !entity.attributes) return \"\";\n  \n  const\
      \ pheno_configs = [\n    { id: 'Vent violent', icon: 'mdi:weather-windy' },\n\
      \    { id: 'Pluie-inondation', icon: 'mdi:weather-pouring' },\n    { id: 'Orages',\
      \ icon: 'mdi:weather-lightning' },\n    { id: 'Inondation', display: 'Innondation',\
      \ icon: 'mdi:home-flood' },\n    { id: 'Neige-verglas', icon: 'mdi:weather-snowy'\
      \ },\n    { id: 'Canicule', icon: 'mdi:weather-sunny-alert' },\n    { id: 'Grand\
      \ froid', icon: 'mdi:snowflake' },\n    { id: 'Avalanches', icon: 'mdi:image-filter-hdr'\
      \ },\n    { id: 'Vagues-submersion', icon: 'mdi:waves' }\n  ];\n  \n  const\
      \ p_levels = ['Rouge', 'Orange', 'Jaune'];\n  const p_colors = { 'Rouge': '#f44336',\
      \ 'Orange': '#ff9800', 'Jaune': '#ffeb3b' };\n  \n  let final_html = '<div style=\"\
      display: flex; flex-direction: column; gap: 8px;\">';\n  let has_any = false;\n\
      \  \n  p_levels.forEach(lvl => {\n    pheno_configs.forEach(conf => {\n    \
      \  if (entity.attributes[conf.id] === lvl) {\n        has_any = true;\n    \
      \    const c = p_colors[lvl];\n        const displayName = conf.display || conf.id;\n\
      \        final_html += `\n          <div style=\"\n            background: rgba(20,\
      \ 27, 38, 0.6);\n            backdrop-filter: blur(20px);\n            -webkit-backdrop-filter:\
      \ blur(20px);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n   \
      \         border-radius: 16px;\n            padding: 12px 20px;\n          \
      \  display: flex;\n            align-items: center;\n            justify-content:\
      \ space-between;\n            box-shadow: 0 4px 15px rgba(0,0,0,0.2);\n    \
      \      \">\n            <div style=\"display: flex; align-items: center; gap:\
      \ 10px;\">\n              <ha-icon icon=\"${conf.icon}\" style=\"color: ${c};\
      \ filter: drop-shadow(0 0 5px ${c}80); width: 22px; height: 22px;\"></ha-icon>\n\
      \              <div style=\"font-weight: 800; font-size: 14px; color: white;\
      \ letter-spacing: 0.5px; text-shadow: 0 1px 3px rgba(0,0,0,0.8);\">\n      \
      \          ${displayName}\n              </div>\n            </div>\n      \
      \      <div style=\"font-weight: 900; font-size: 11px; text-transform: uppercase;\
      \ letter-spacing: 1px; color: ${c}; text-shadow: 0 0 10px rgba(0,0,0,0.5); animation:\
      \ dash_blink_pulse 2s infinite;\">\n              Vigilance ${lvl}\n       \
      \     </div>\n          </div>\n        `;\n      }\n    });\n  });\n  \n  final_html\
      \ += '</div>';\n  return has_any ? final_html : \"\";\n]]]\n"
  extra_styles: "@keyframes dash_blink_pulse {\n  0% { opacity: 1; }\n  50% { opacity:\
    \ 0.6; }\n  100% { opacity: 1; }\n}\n"
